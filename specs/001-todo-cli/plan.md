# Implementation Plan: Phase I Todo CLI

**Branch**: `001-todo-cli` | **Date**: 2024-12-24 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/001-todo-cli/spec.md`

**Note**: This plan is derived strictly from the Phase I specification and global constitution. No new features are introduced.

## Summary

Phase I delivers an in-memory Python console todo application with menu-based CLI interaction. The application provides five core operations: add task, view tasks, update task, delete task, and mark complete/incomplete. All data is stored in-memory and lost on application termination. The architecture follows clean separation between data handling (task management) and CLI interface (menu loop, input handling, display).

## Technical Context

**Language/Version**: Python 3.13+
**Primary Dependencies**: Python Standard Library only (no external dependencies)
**Storage**: In-memory Python data structures (list/dictionary)
**Testing**: Not required for Phase I (tests are optional per spec)
**Target Platform**: Cross-platform CLI (Windows, macOS, Linux)
**Project Type**: Single console application
**Performance Goals**: Add task within 5 seconds, view list within 2 seconds, launch within 1 second
**Constraints**: No databases, no file storage, no web frameworks, no external services, single-user only
**Scale/Scope**: Single user, up to ~100 tasks in memory, single process

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Core Principles Compliance

| Principle | Compliance | Notes |
|-----------|------------|-------|
| I. Spec-Driven Development | ✅ PASS | Plan derived from spec.md, no new features added |
| II. Agent Behavior Rules | ✅ PASS | No feature invention, strict adherence to spec requirements |
| III. Phase Governance | ✅ PASS | Only Phase I features (in-memory, CLI, no persistence) |
| IV. Quality Principles | ✅ PASS | Clean architecture with data/CLI separation |

### Phase I Technology Matrix Compliance

| Technology | Phase I Allowed | Used | Compliance |
|------------|-----------------|------|------------|
| Python | ✅ | ✅ | ✅ PASS |
| CLI Interface | ✅ | ✅ | ✅ PASS |
| In-Memory Storage | ✅ | ✅ | ✅ PASS |
| FastAPI | ❌ | ❌ | ✅ PASS (not used) |
| SQLModel | ❌ | ❌ | ✅ PASS (not used) |
| Neon DB | ❌ | ❌ | ✅ PASS (not used) |
| Next.js | ❌ | ❌ | ✅ PASS (not used) |
| OpenAI Agents SDK | ❌ | ❌ | ✅ PASS (not used) |
| MCP | ❌ | ❌ | ✅ PASS (not used) |
| Docker | ❌ | ❌ | ✅ PASS (not used) |
| Kubernetes | ❌ | ❌ | ✅ PASS (not used) |
| Kafka | ❌ | ❌ | ✅ PASS (not used) |
| Dapr | ❌ | ❌ | ✅ PASS (not used) |

### Agent Behavior Rules
- ✅ No manual coding by humans (all code generated by agents from this plan)
- ✅ No feature invention (all features from spec only)
- ✅ No deviation from spec (implement spec requirements exactly)
- ✅ No future phase concepts (no persistence, web, or multi-user features)

**Result**: ✅ ALL GATES PASSED - Proceed to Phase 0

## Project Structure

### Documentation (this feature)

```text
specs/001-todo-cli/
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (/sp.plan command)
├── data-model.md        # Phase 1 output (/sp.plan command)
├── quickstart.md        # Phase 1 output (/sp.plan command)
├── contracts/           # Phase 1 output (/sp.plan command)
│   └── cli-contract.md  # CLI interface contract
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
src/
└── todo_app.py          # Single file application (main entry point)

tests/                   # Optional - only if tests requested in spec
└── (Phase I: no tests required)
```

**Structure Decision**: Single Python file architecture (`src/todo_app.py`)
- **Rationale**: Phase I is intentionally simple. All functionality fits in a single file with clear separation between data functions and CLI functions. This avoids over-engineering and aligns with constitution "simple functions" principle.
- **Data Functions**: Task storage, ID generation, task operations (add, update, delete, mark)
- **CLI Functions**: Menu display, input handling, output formatting, error display
- **Main Loop**: Application startup, menu loop, exit handling

## Complexity Tracking

> No constitution violations requiring justification. Plan passes all gates.

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| N/A | N/A | N/A |

---

## Phase 0: Research & Technology Decisions

### Research Completed

See [research.md](research.md) for detailed findings.

**Key Decisions**:
1. **Python 3.13+**: Chosen for modern syntax, type hints, dataclasses support (from constitution)
2. **Standard Library Only**: No external dependencies (aligns with Phase I simplicity)
3. **Single File Architecture**: All code in `src/todo_app.py` for simplicity
4. **List-based Task Storage**: Python list for ordered tasks, dictionary for quick ID lookup
5. **Sequential ID Generation**: Counter starting at 1, incremented on each add

---

## Phase 1: Design & Contracts

### Data Model

See [data-model.md](data-model.md) for complete entity definitions.

**Key Entities**:
- **Task**: id (int), description (str), status (enum), created_at (datetime)
- **TaskList**: tasks (list[Task]), next_id (int)

### CLI Contract

See [contracts/cli-contract.md](contracts/cli-contract.md) for CLI interface specification.

**Interface Contract**:
- Menu display with 7 numbered options
- Prompt/response pattern for each operation
- Error messages to stderr, success/output to stdout
- Return to main menu after each operation

### Quickstart Guide

See [quickstart.md](quickstart.md) for running the application.

**Quick Steps**:
1. Ensure Python 3.13+ installed
2. Navigate to project root
3. Run: `python src/todo_app.py`
4. Follow menu prompts

---

## Architecture Design

### High-Level Application Structure

```
┌─────────────────────────────────────────┐
│         Main Application Entry          │
│         (if __name__ == "__main__")    │
└─────────────────┬───────────────────────┘
                  │
                  │ Starts
                  ▼
┌─────────────────────────────────────────┐
│           Menu Loop (while True)         │
│  ┌────────────────────────────────────┐ │
│  │ 1. Display Menu                    │ │
│  │ 2. Get User Choice                │ │
│  │ 3. Route to Action Function       │ │
│  │ 4. Execute Action                 │ │
│  │ 5. Return to Menu (unless Exit)   │ │
│  └────────────────────────────────────┘ │
└─────────────────┬───────────────────────┘
                  │
                  │ Routes to
      ┌───────────┼───────────┬───────────┐
      ▼           ▼           ▼           ▼
┌─────────┐ ┌──────────┐ ┌─────────┐ ┌────────┐
│ add_task │ │ view_tasks│ │update_  │ │delete_ │
│         │ │          │ │ task    │ │ task   │
└────┬────┘ └──────┬───┘ └────┬────┘ └───┬────┘
     │             │           │           │
     ▼             ▼           ▼           ▼
┌─────────────────────────────────────────┐
│         Data Layer Functions            │
│  - add_task()                          │
│  - get_task(id)                        │
│  - update_task(id, desc)               │
│  - delete_task(id)                     │
│  - mark_complete(id)                   │
│  - mark_incomplete(id)                 │
│  - list_tasks()                        │
└─────────────────┬───────────────────────┘
                  │
                  │ Manages
                  ▼
┌─────────────────────────────────────────┐
│       In-Memory Data Structures         │
│  - tasks: list[Task]                   │
│  - next_id: int                        │
└─────────────────────────────────────────┘
```

### In-Memory Data Structures

```python
# Task representation (dataclass or simple class)
class Task:
    def __init__(self, id: int, description: str, status: str):
        self.id = id
        self.description = description
        self.status = status  # "completed" or "incomplete"
        self.created_at = datetime.now()

# Task list storage
tasks: list[Task] = []           # Ordered list of all tasks
next_id: int = 1                 # Counter for generating unique IDs
```

### Task Identification Strategy

**ID Generation**:
- Sequential integer starting at 1
- Incremented by 1 for each new task
- IDs never reused (deleted tasks keep their IDs permanently)
- Example: Task 1, Task 2, Task 3, delete Task 2, next task is Task 4

**ID Assignment Flow**:
```
add_task() called
    │
    ├─> Create Task with id = next_id
    ├─> Append to tasks list
    └─> Increment next_id (next_id += 1)
```

### CLI Control Flow

```
Application Start
        │
        ▼
┌──────────────────────────┐
│  Display Main Menu       │
│  1. Add Task             │
│  2. View Tasks           │
│  3. Update Task          │
│  4. Delete Task          │
│  5. Mark Complete        │
│  6. Mark Incomplete      │
│  7. Exit                 │
└────────────┬─────────────┘
             │
             ▼
┌──────────────────────────┐
│  Prompt: "Enter choice"  │
└────────────┬─────────────┘
             │
             ▼
     ┌───────┴───────┐
     │  Validate     │
     │  Input        │
     └───────┬───────┘
             │
       ┌─────┴─────┐
       │           │
       ▼           ▼
   Valid       Invalid
   Input        Input
       │           │
       │           ▼
       │   ┌─────────────────┐
       │   │ Show Error Msg  │
       │   │ "Invalid choice"│
       │   └────────┬────────┘
       │            │
       └─────┬──────┘
             │
             ▼
┌──────────────────────────┐
│  Route to Action         │
│  (1-6: execute, 7: exit)│
└────────────┬─────────────┘
             │
       ┌─────┴─────┐
       │           │
       ▼           ▼
   Action      Exit
   Executed    App
       │           │
       ▼           │
┌───────────────┐    │
│ Show Result   │    │
│ (success/error│    │
│  message)     │    │
└───────┬───────┘    │
        │            │
        └─────┬──────┘
              │
              ▼ (loop back to menu)
```

### Separation of Responsibilities

**Data Layer Functions** (pure operations on task list):
```python
def add_task(description: str) -> Task
def get_task(id: int) -> Task | None
def update_task(id: int, description: str) -> bool
def delete_task(id: int) -> bool
def mark_complete(id: int) -> bool
def mark_incomplete(id: int) -> bool
def list_tasks() -> list[Task]
```

**CLI Layer Functions** (input/output):
```python
def display_menu() -> None
def get_user_choice() -> int
def display_tasks(tasks: list[Task]) -> None
def prompt_for_input(prompt: str) -> str
def display_error(message: str) -> None
def display_success(message: str) -> None
```

**Main Loop Function**:
```python
def run_menu_loop() -> None
```

### Error Handling Strategy

**Input Validation Errors**:
- Empty description → "Error: Task description cannot be empty."
- Non-numeric ID input → "Error: Please enter a valid numeric task ID."
- Invalid menu choice → "Error: Invalid choice. Please enter 1-7."

**Operation Errors**:
- Task ID not found → "Error: Task not found with ID: {id}"
- Empty task list → "Error: No tasks found in the list."

**Error Handling Flow**:
```
Input Received
    │
    ▼
┌───────────────┐
│  Validate     │
└───────┬───────┘
        │
    ┌───┴───┐
    │       │
    ▼       ▼
Valid    Invalid
Input     Input
    │       │
    │       ▼
    │   ┌──────────────────────┐
    │   │ Display Error Msg    │
    │   │ (stderr)             │
    │   └──────────┬───────────┘
    │              │
    └───────┬──────┘
            │
            ▼
    Perform Operation
            │
        ┌───┴───┐
        │       │
        ▼       ▼
   Success    Error
   (found)    (not found)
        │       │
        │       ▼
        │   ┌──────────────────────┐
        │   │ Display Error Msg    │
        │   │ (stderr)             │
        │   └──────────┬───────────┘
        │              │
        └───────┬──────┘
                │
                ▼
        Return to Menu
```

### Validation Rules Summary

| Input Type | Validation | Error Message |
|------------|------------|---------------|
| Menu choice | Must be 1-7 | "Error: Invalid choice. Please enter 1-7." |
| Task ID | Must be numeric | "Error: Please enter a valid numeric task ID." |
| Task description | Must be non-empty | "Error: Task description cannot be empty." |
| Task description | Truncate to 500 chars | "Warning: Description truncated to 500 characters." |
| Task ID (operations) | Must exist in list | "Error: Task not found with ID: {id}" |
| Task ID (empty list) | Check list not empty first | "Error: No tasks found in the list." |

---

## Implementation Notes

### No Future Phase Concepts

The following are explicitly excluded:
- ❌ Database connections or ORM
- ❌ File I/O or configuration files
- ❌ Web frameworks or API endpoints
- ❌ User authentication or authorization
- ❌ Multi-user support
- ❌ Task categories, tags, or priorities
- ❌ Due dates or reminders
- ❌ Task filtering or sorting
- ❌ Persistent storage mechanisms

### Performance Considerations

- **Add Task**: O(1) - append to list
- **View Tasks**: O(n) - iterate through list
- **Update Task**: O(n) - find by ID then update
- **Delete Task**: O(n) - find by ID then remove
- **Mark Complete/Incomplete**: O(n) - find by ID then update

For Phase I scale (~100 tasks), O(n) operations are acceptable.

### Unicode and Special Characters

- Python 3 strings are Unicode by default
- No special handling required for emojis or special characters
- All string operations work correctly with Unicode input

---

## Constitution Check (Post-Design)

*Re-verification after Phase 1 design completion*

### Core Principles Compliance (Post-Design)
- ✅ Spec-Driven Development: All design elements derived from spec.md
- ✅ Agent Behavior Rules: No new features added, strict adherence
- ✅ Phase Governance: Only Phase I technologies and features
- ✅ Quality Principles: Clean separation of data and CLI layers

### Technology Matrix Compliance (Post-Design)
- ✅ Python used, no prohibited technologies
- ✅ In-memory storage only, no databases/files
- ✅ CLI interface only, no web/GUI frameworks
- ✅ No external dependencies (standard library only)
- ✅ No future phase technologies (FastAPI, SQLModel, etc.)

**Result**: ✅ ALL GATES PASSED - Ready for Phase 2 (tasks generation)
